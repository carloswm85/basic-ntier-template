%%{init: {
    "theme": "dark",
    "themeVariables": {
        "primaryColor": "#1a1a2e",
        "primaryTextColor": "#eee",
        "primaryBorderColor": "#FF00FF",
        "lineColor": "#FF00FF",
        "secondaryColor": "#16213e",
        "tertiaryColor": "#0f3460"
    }
}}%%

stateDiagram-v2
    [*] --> UserAccess: User Initiates Request
    
    state UserAccess {
        [*] --> IntranetUser: Internal Employee
        [*] --> InternetUser: External User
        
        IntranetUser --> IntranetNetwork: Via Corporate Network
        InternetUser --> PublicInternet: Via Internet
    }
    
    state "Access Layer" as AccessLayer {
        IntranetNetwork --> Firewall1: Internal Traffic
        PublicInternet --> Firewall1: External Traffic
        
        Firewall1 --> LoadBalancer: Security Check Passed
    }
    
    state "Presentation Layer" as PresentationLayer {
        LoadBalancer --> WebMVC: Route to MVC App
        LoadBalancer --> AngularSPA: Route to Angular App
        LoadBalancer --> MobileAPI: Route to Mobile API
        
        WebMVC --> RESTfulAPI: API Calls
        AngularSPA --> RESTfulAPI: API Calls
        MobileAPI --> RESTfulAPI: API Calls
    }
    
    state "API Layer" as APILayer {
        RESTfulAPI --> Authentication: Validate User
        Authentication --> Authorization: Check Permissions
        Authorization --> ServiceLayer: Forward Request
    }
    
    state "Business Logic" as BusinessLogic {
        ServiceLayer --> DTOMapping: Transform Data
        DTOMapping --> ValidationLayer: Validate Business Rules
        ValidationLayer --> RepositoryLayer: Data Access Request
    }
    
    state "Data Access" as DataAccess {
        RepositoryLayer --> UnitOfWork: Transaction Management
        UnitOfWork --> EFCore: ORM Operations
        EFCore --> DatabaseServer: Execute Query
    }
    
    state "Storage Layer" as StorageLayer {
        DatabaseServer --> SQLServer: Store/Retrieve Data
        SQLServer --> BackupSystem: Scheduled Backups
        BackupSystem --> OrganizationServers: Secure Storage
    }
    
    OrganizationServers --> SQLServer: Restore if Needed
    SQLServer --> DatabaseServer: Return Data
    DatabaseServer --> EFCore: Result Set
    EFCore --> UnitOfWork: Mapped Entities
    UnitOfWork --> RepositoryLayer: Domain Models
    RepositoryLayer --> ServiceLayer: Data Transfer
    ServiceLayer --> DTOMapping: Transform to DTOs
    DTOMapping --> RESTfulAPI: Response Payload
    RESTfulAPI --> PresentationLayer: HTTP Response
    PresentationLayer --> AccessLayer: Render to Client
    AccessLayer --> UserAccess: Display Result
    UserAccess --> [*]: Request Completed
    
    note right of IntranetUser
        Corporate employees accessing
        via internal network with
        direct VPN or LAN connection
    end note
    
    note right of InternetUser
        External users, mobile apps,
        and public-facing clients
        via HTTPS
    end note
    
    note right of OrganizationServers
        Data persisted in organization's
        secure servers with redundancy,
        backups, and disaster recovery
    end note